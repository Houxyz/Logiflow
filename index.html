<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LogiFlow - Home</title>
    <link rel="stylesheet" href="style/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Pantalla de verificación de autenticación -->
    <div id="auth-check" class="auth-overlay">
        <div class="auth-spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Verificando autenticación...</p>
        </div>
    </div>

    <!-- Contenido principal (oculto hasta verificar autenticación) -->
    <div id="main-content" class="hidden">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-container">
                <div class="nav-brand">
                    <h2><i class="fas fa-boxes"></i> LogiFlow</h2>
                </div>
                <div class="nav-center">
                    <a href="index.html" class="home-btn">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                    </a>
                </div>
                <div class="header-actions">
                    <div class="user-info">
                        <span id="user-name">Usuario</span>
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                        Cerrar Sesión
                    </button>
                </div>
            </div>
        </header>

        <!-- Contenido principal -->
        <main class="main-content">
            <div class="container">
                <!-- Título de bienvenida -->
                <div class="welcome-section">
                    <h1>Bienvenido a LogiFlow</h1>
                    <p>Sistema integral de gestión logística y normativas</p>
                </div>

                <!-- Secciones expandibles -->
                <div class="sections-container">
                    <!-- Sección 1: Información y Novedades -->
                    <div class="expandable-section">
                        <div class="section-header" onclick="toggleSection('info-section')">
                            <div class="section-title">
                                <i class="fas fa-info-circle"></i>
                                <h3>Información y Novedades</h3>
                            </div>
                            <i class="fas fa-chevron-down section-arrow" id="info-arrow"></i>
                        </div>
                        <div class="section-content" id="info-section">
                            <div class="subsections-grid">
                                <div class="subsection-card">
                                    <i class="fas fa-newspaper"></i>
                                    <h4>Últimas Noticias</h4>
                                    <p>Mantente al día con las últimas actualizaciones del sistema</p>
                                    <button class="subsection-btn">Ver más</button>
                                </div>
                                <div class="subsection-card">
                                    <i class="fas fa-bell"></i>
                                    <h4>Notificaciones</h4>
                                    <p>Revisa tus notificaciones importantes</p>
                                    <button class="subsection-btn">Ver más</button>
                                </div>
                                <div class="subsection-card">
                                    <i class="fas fa-calendar"></i>
                                    <h4>Eventos</h4>
                                    <p>Próximos eventos y fechas importantes</p>
                                    <button class="subsection-btn">Ver más</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección 2: Base de datos normativas MX -->
                    <div class="expandable-section">
                        <div class="section-header" onclick="toggleSection('normativas-section')">
                            <div class="section-title">
                                <i class="fas fa-database"></i>
                                <h3>Base de Datos Normativas MX</h3>
                            </div>
                            <i class="fas fa-chevron-down section-arrow" id="normativas-arrow"></i>
                        </div>
                        <div class="section-content" id="normativas-section">
                            <div class="subsections-grid">
                                <div class="subsection-card">
                                    <i class="fas fa-file-import"></i>
                                    <h4>Ejemplos Importación/Exportación</h4>
                                    <p>Guías y ejemplos prácticos para procesos de importación y exportación</p>
                                    <button class="subsection-btn">Acceder</button>
                                </div>
                                <div class="subsection-card">
                                    <i class="fas fa-file-alt"></i>
                                    <h4>Boletín Informativo</h4>
                                    <p>Boletines oficiales y comunicados importantes</p>
                                    <button class="subsection-btn">Acceder</button>
                                </div>
                                <div class="subsection-card">
                                    <i class="fas fa-puzzle-piece"></i>
                                    <h4>Complementos</h4>
                                    <p>Herramientas y complementos adicionales</p>
                                    <button class="subsection-btn">Acceder</button>
                                </div>
                                <div class="subsection-card">
                                    <i class="fas fa-check-circle"></i>
                                    <h4>Validador</h4>
                                    <p>Herramienta de validación de documentos y procesos</p>
                                    <button class="subsection-btn">Acceder</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección 3: Consultas -->
                    <div class="expandable-section">
                        <div class="section-header" onclick="toggleSection('consultas-section')">
                            <div class="section-title">
                                <i class="fas fa-search"></i>
                                <h3>Consultas</h3>
                            </div>
                            <i class="fas fa-chevron-down section-arrow" id="consultas-arrow"></i>
                        </div>
                        <div class="section-content" id="consultas-section">
                            <div class="consultas-header">
                                <h4>Consulta de Documentos PDF</h4>
                                <p>Busca y consulta todos los documentos PDF cargados por los administradores</p>
                            </div>
                            
                            <div class="search-container">
                                <div class="search-box">
                                    <i class="fas fa-search"></i>
                                    <input type="text" id="pdf-search" placeholder="Buscar documentos PDF..." onkeyup="searchPDFs()">
                                    <button class="search-btn" onclick="searchPDFs()">Buscar</button>
                                </div>
                                <div class="filter-options">
                                    <select id="category-filter" onchange="filterPDFs()">
                                        <option value="">Todas las categorías</option>
                                        <option value="normativas">Normativas</option>
                                        <option value="procedimientos">Procedimientos</option>
                                        <option value="formularios">Formularios</option>
                                        <option value="manuales">Manuales</option>
                                        <option value="reportes">Reportes</option>
                                    </select>
                                    <select id="date-filter" onchange="filterPDFs()">
                                        <option value="">Todas las fechas</option>
                                        <option value="today">Hoy</option>
                                        <option value="week">Esta semana</option>
                                        <option value="month">Este mes</option>
                                        <option value="year">Este año</option>
                                    </select>
                                </div>
                            </div>

                            <div class="pdf-results" id="pdf-results">
                                <div class="results-header">
                                    <span id="results-count">Mostrando 0 documentos</span>
                                    <div class="view-options">
                                        <button class="view-btn active" onclick="setView('grid')" data-view="grid">
                                            <i class="fas fa-th"></i>
                                        </button>
                                        <button class="view-btn" onclick="setView('list')" data-view="list">
                                            <i class="fas fa-list"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="pdf-grid" id="pdf-grid">
                                    <!-- Los PDFs se cargarán dinámicamente aquí -->
                                    <div class="no-results">
                                        <i class="fas fa-file-pdf"></i>
                                        <h5>No hay documentos disponibles</h5>
                                        <p>Los documentos PDF aparecerán aquí cuando sean cargados por los administradores</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Verificar autenticación al cargar la página
        window.addEventListener('DOMContentLoaded', function() {
            checkAuthentication();
        });

        function checkAuthentication() {
            // Simular verificación de autenticación
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            const userType = localStorage.getItem('userType');
            
            setTimeout(() => {
                if (isLoggedIn === 'true') {
                    // Usuario autenticado, mostrar contenido
                    document.getElementById('auth-check').style.display = 'none';
                    document.getElementById('main-content').classList.remove('hidden');
                    
                    // Mostrar nombre de usuario
                    const userName = localStorage.getItem('userName') || 'Usuario';
                    document.getElementById('user-name').textContent = userName;
                    
                    // Cargar PDFs al mostrar el contenido
                    loadPDFs();
                } else {
                    // Usuario no autenticado, redirigir al login
                    window.location.href = 'login.html';
                }
            }, 1500); // Simular tiempo de verificación
        }

        function logout() {
            // Limpiar datos de sesión
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('userType');
            localStorage.removeItem('userName');
            
            // Redirigir al landing
            window.location.href = 'landing.html';
        }

        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            const arrow = document.getElementById(sectionId.replace('-section', '-arrow'));
            
            if (section.classList.contains('expanded')) {
                section.classList.remove('expanded');
                arrow.style.transform = 'rotate(0deg)';
            } else {
                // Cerrar otras secciones
                document.querySelectorAll('.section-content').forEach(s => {
                    s.classList.remove('expanded');
                });
                document.querySelectorAll('.section-arrow').forEach(a => {
                    a.style.transform = 'rotate(0deg)';
                });
                
                // Abrir sección actual
                section.classList.add('expanded');
                arrow.style.transform = 'rotate(180deg)';
            }
        }

        // Animaciones de aparición
        function animateOnScroll() {
            const elements = document.querySelectorAll('.subsection-card');
            elements.forEach(element => {
                const elementTop = element.getBoundingClientRect().top;
                const elementVisible = 150;
                
                if (elementTop < window.innerHeight - elementVisible) {
                    element.classList.add('animate');
                }
            });
        }

        window.addEventListener('scroll', animateOnScroll);
        animateOnScroll(); // Ejecutar al cargar

        // Variables globales para PDFs
        let allPDFs = [];
        let filteredPDFs = [];
        let currentView = 'grid';

        // Función para cargar PDFs desde el servidor
        async function loadPDFs() {
            try {
                // Simulación de datos - en producción esto vendría del backend
                allPDFs = [
                    {
                        id: 1,
                        name: "Manual de Procedimientos Aduaneros",
                        category: "manuales",
                        uploadDate: "2024-01-15",
                        size: "2.5 MB",
                        description: "Manual completo de procedimientos aduaneros actualizados",
                        url: "/pdfs/manual-procedimientos.pdf"
                    },
                    {
                        id: 2,
                        name: "Normativa de Importación 2024",
                        category: "normativas",
                        uploadDate: "2024-01-10",
                        size: "1.8 MB",
                        description: "Nuevas normativas de importación vigentes para 2024",
                        url: "/pdfs/normativa-importacion.pdf"
                    },
                    {
                        id: 3,
                        name: "Formulario DUA Actualizado",
                        category: "formularios",
                        uploadDate: "2024-01-08",
                        size: "0.5 MB",
                        description: "Formulario DUA con las últimas actualizaciones",
                        url: "/pdfs/formulario-dua.pdf"
                    }
                ];
                
                filteredPDFs = [...allPDFs];
                displayPDFs();
                updateResultsCount();
            } catch (error) {
                console.error('Error cargando PDFs:', error);
            }
        }

        // Función para buscar PDFs
        function searchPDFs() {
            const searchTerm = document.getElementById('pdf-search').value.toLowerCase();
            const categoryFilter = document.getElementById('category-filter').value;
            const dateFilter = document.getElementById('date-filter').value;

            filteredPDFs = allPDFs.filter(pdf => {
                const matchesSearch = pdf.name.toLowerCase().includes(searchTerm) || 
                                    pdf.description.toLowerCase().includes(searchTerm);
                const matchesCategory = !categoryFilter || pdf.category === categoryFilter;
                const matchesDate = filterByDate(pdf.uploadDate, dateFilter);

                return matchesSearch && matchesCategory && matchesDate;
            });

            displayPDFs();
            updateResultsCount();
        }

        // Función para filtrar PDFs
        function filterPDFs() {
            searchPDFs();
        }

        // Función para filtrar por fecha
        function filterByDate(uploadDate, filter) {
            if (!filter) return true;

            const today = new Date();
            const pdfDate = new Date(uploadDate);

            switch (filter) {
                case 'today':
                    return pdfDate.toDateString() === today.toDateString();
                case 'week':
                    const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                    return pdfDate >= weekAgo;
                case 'month':
                    return pdfDate.getMonth() === today.getMonth() && 
                           pdfDate.getFullYear() === today.getFullYear();
                case 'year':
                    return pdfDate.getFullYear() === today.getFullYear();
                default:
                    return true;
            }
        }

        // Función para mostrar PDFs
        function displayPDFs() {
            const pdfGrid = document.getElementById('pdf-grid');
            
            if (filteredPDFs.length === 0) {
                pdfGrid.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-file-pdf"></i>
                        <h5>No se encontraron documentos</h5>
                        <p>No hay documentos que coincidan con los criterios de búsqueda</p>
                    </div>
                `;
                return;
            }

            const pdfHTML = filteredPDFs.map(pdf => `
                <div class="pdf-card ${currentView}">
                    <div class="pdf-icon">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    <div class="pdf-info">
                        <h5>${pdf.name}</h5>
                        <p class="pdf-description">${pdf.description}</p>
                        <div class="pdf-meta">
                            <span class="pdf-category">${getCategoryName(pdf.category)}</span>
                            <span class="pdf-size">${pdf.size}</span>
                            <span class="pdf-date">${formatDate(pdf.uploadDate)}</span>
                        </div>
                    </div>
                    <div class="pdf-actions">
                        <button class="pdf-btn view-btn" onclick="viewPDF('${pdf.url}')">
                            <i class="fas fa-eye"></i> Ver
                        </button>
                        <button class="pdf-btn download-btn" onclick="downloadPDF('${pdf.url}', '${pdf.name}')">
                            <i class="fas fa-download"></i> Descargar
                        </button>
                    </div>
                </div>
            `).join('');

            pdfGrid.innerHTML = pdfHTML;
        }

        // Función para cambiar vista
        function setView(view) {
            currentView = view;
            
            // Actualizar botones activos
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-view="${view}"]`).classList.add('active');
            
            // Actualizar clase del grid
            const pdfGrid = document.getElementById('pdf-grid');
            pdfGrid.className = `pdf-grid ${view}`;
            
            displayPDFs();
        }

        // Función para actualizar contador de resultados
        function updateResultsCount() {
            const count = filteredPDFs.length;
            const resultsCount = document.getElementById('results-count');
            resultsCount.textContent = `Mostrando ${count} documento${count !== 1 ? 's' : ''}`;
        }

        // Función para obtener nombre de categoría
        function getCategoryName(category) {
            const categories = {
                'normativas': 'Normativas',
                'procedimientos': 'Procedimientos',
                'formularios': 'Formularios',
                'manuales': 'Manuales',
                'reportes': 'Reportes'
            };
            return categories[category] || category;
        }

        // Función para formatear fecha
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('es-ES', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        // Función para ver PDF
        function viewPDF(url) {
            window.open(url, '_blank');
        }

        // Función para descargar PDF
        function downloadPDF(url, filename) {
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>